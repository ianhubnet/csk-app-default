# ----------------------------------------------------------------------
# Environment Configurations
# ----------------------------------------------------------------------
# Multiple Environment config, set this to development, staging, or production
# Uncomment to set the CI environment
# SetEnv CI_ENV production

# ----------------------------------------------------------------------
# Proper MIME type for all files
# ----------------------------------------------------------------------
<IfModule mod_mime.c>
	# JavaScript and JSON
	AddType application/javascript js jsonp
	AddType application/json json

	# Audio
	AddType audio/mp4 m4a f4a f4b
	AddType audio/ogg oga ogg

	# Video
	AddType video/mp4 mp4 m4v f4v f4p
	AddType video/ogg ogv
	AddType video/webm webm
	AddType video/x-flv flv

	# SVG and Fonts
	AddEncoding gzip svgz
	AddType application/font-woff woff
	AddType application/vnd.ms-fontobject eot
	AddType application/x-font-ttf ttf ttc
	AddType font/opentype otf
	AddType font/woff2 woff2
	AddType image/svg+xml svg svgz

	# Miscellaneous
	AddType application/octet-stream safariextz
	AddType application/x-chrome-extension crx
	AddType application/x-opera-extension oex
	AddType application/x-shockwave-flash swf
	AddType application/x-web-app-manifest+json webapp
	AddType application/x-xpinstall xpi
	AddType application/xml rss atom xml rdf
	AddType image/webp webp
	AddType image/x-icon ico
	AddType text/cache-manifest appcache manifest
	AddType text/vtt vtt
	AddType text/x-component htc
	AddType text/x-vcard vcf
</IfModule>

# ----------------------------------------------------------------------
# Limit Requests Per IP Address
# ----------------------------------------------------------------------
<IfModule mod_limitipconn.c>
	MaxConnPerIP 20
	OnlyIPLimit application/x-php
</IfModule>

<IfModule mod_evasive20.c>
	DOSHashTableSize 3097
	DOSPageCount 10
	DOSSiteCount 50
	DOSPageInterval 1
	DOSSiteInterval 1
	DOSBlockingPeriod 10
</IfModule>

# ----------------------------------------------------------------------
# Gzip Compression
# ----------------------------------------------------------------------
<IfModule mod_deflate.c>
	AddOutputFilterByType DEFLATE application/atom+xml \
						  application/javascript \
						  application/json \
						  application/rss+xml \
						  application/vnd.ms-fontobject \
						  application/x-font-ttf \
						  application/xhtml+xml \
						  application/xml \
						  font/opentype \
						  image/svg+xml \
						  image/x-icon \
						  text/css \
						  text/html \
						  text/plain \
						  text/x-component \
						  text/xml
</IfModule>

# ----------------------------------------------------------------------
# Inform proxies/CDNs that the response varies based on encoding
# ----------------------------------------------------------------------
<IfModule mod_headers.c>
	<FilesMatch "\.(js|css|xml|gz|svg|ttf|otf|eot|woff|woff2)$">
		# Add Vary: Accept-Encoding for better caching and compression handling
		Header append Vary: Accept-Encoding
	</FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# UTF-8 Encoding
# ----------------------------------------------------------------------
AddDefaultCharset utf-8
<IfModule mod_mime.c>
	AddCharset utf-8 .atom .css .js .json .rss .vtt .xml
</IfModule>

# ----------------------------------------------------------------------
# Security Settings
# ----------------------------------------------------------------------
# "-Indexes" will have Apache block users from browsing folders without a
# default document Usually you should leave this activated, because you
# shouldn't allow everybody to surf through every folder on your server (which
# includes rather private places like CMS system folders).
<IfModule mod_autoindex.c>
	Options -Indexes
</IfModule>

# Block access to "hidden" directories or files whose names begin with a
# period. This includes directories used by version control systems such as
# Subversion or Git.
<IfModule mod_rewrite.c>
	RewriteCond %{SCRIPT_FILENAME} -d [OR]
	RewriteCond %{SCRIPT_FILENAME} -f
	RewriteRule "(^|/)\." - [F]
</IfModule>

# Block access to backup and source files. These files may be left by some
# text/html editors and pose a great security danger, when anyone can access
# them.
<FilesMatch "(^#.*#|\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op])|~)$">
	Order allow,deny
	Deny from all
	Satisfy All
</FilesMatch>

# Prevent 'Access-Control-Allow-Origin' error.
<FilesMatch "\.(eot|ttf|otf|woff|woff2)$">
	Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# ----------------------------------------------------------------------
# Rewrite Engine
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
	Options +FollowSymLinks
	RewriteEngine On

	# If you installed Skeleton in a subfolder, you will need to
	# change the following line to match the subfolder you need.
	# http://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritebase
	#RewriteBase /

	# NOTICE: If you get a 404 play with combinations of the following commented out lines
	#AllowOverride All
	#RewriteBase /wherever/CiSkeleton/is

	# Make sure directory listing is disabled
	Options +FollowSymLinks -Indexes

	# Restrict your site to only one domain
	# IMPORTANT: Uncomment ONLY ONE of the following options

	# Option 1: Redirect www.domain.com → domain.com
	#RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
	#RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

	# Option 2: Redirect domain.com → www.domain.com (skip subdomains)
	#RewriteCond %{HTTP_HOST} !^(www|static|cdn)\. [NC]
	#RewriteCond %{HTTP_HOST} ^([a-z0-9-]+)\.([a-z.]{2,})$ [NC]
	#RewriteRule ^ https://www.%1.%2%{REQUEST_URI} [R=301,L]

	#RewriteBase Adjustments
	#RewriteBase /

	# Remove index.php from URL
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ index.php/$1 [L]
</IfModule>

# ----------------------------------------------------------------------
# Browser Caching
# ----------------------------------------------------------------------
<IfModule mod_expires.c>
	ExpiresActive On
	ExpiresByType application/javascript "access 1 month"

	# JavaScript and CSS: cache for 1 month
	ExpiresByType text/css "access 1 month"

	# HTML documents: cache for 2 days (so users still get updated content reasonably fast)
	ExpiresByType text/html "access 2 days"

	# Images: cache for 1 year (rarely change)
	ExpiresByType image/gif "access 1 year"
	ExpiresByType image/jpeg "access 1 year"
	ExpiresByType image/png "access 1 year"
	ExpiresByType image/svg+xml "access 1 year"
	ExpiresByType image/webp "access plus 1 year"

	# Fonts: cache for 1 year
	ExpiresByType font/ttf "access 1 year"
	ExpiresByType font/woff "access 1 year"
	ExpiresByType font/woff2 "access 1 year"
	ExpiresByType application/font-woff "access 1 year"

	# Fallback to all other files
	ExpiresDefault "access 2 days"
</IfModule>
